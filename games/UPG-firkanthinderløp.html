
<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Firkanthinderløp-UPGRADEDa</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  background:#0f0f0f;
  color:white;
  font-family:Arial;
  margin:0;
  padding:20px;
}
#gameBox{
  width:560px;
  height:260px;
  background:#222;
  margin:20px auto;
  border:2px solid white;
  position:relative;
  overflow:hidden;
}
#player{
  width:40px;
  height:40px;
  background:#00ffff;
  position:absolute;
  left:60px;
  bottom:0;
}
.obstacle{position:absolute;background:red}
.powerup{
  position:absolute;
  width:24px;
  height:24px;
  background:yellow;
}
#ui{text-align:center;font-size:14px}
#gameOver{
  text-align:center;
  font-size:26px;
  color:red;
  display:none;
}
#controls{
  position:absolute;
  left:10px;
  top:10px;
  font-size:13px;
  line-height:1.4;
  opacity:0.85;
}
button{
  padding:8px 14px;
  font-size:16px;
  display:block;
  margin:10px auto;
}
</style>
</head>

<body>

<h2 style="text-align:center">Firkanthinderløp</h2>

<div id="controls">
<b>KONTROLLER</b><br>
Space – Hopp / Dobbelhopp<br>
X – Dash<br>
C – Magnet<br>
V – Teleport
</div>

<div id="ui"></div>

<div id="gameBox">
  <div id="player"></div>
</div>

<div id="gameOver">GAME OVER</div>
<button>Spill igjen</button>

<script>
const player = document.getElementById("player");
const gameBox = document.getElementById("gameBox");
const ui = document.getElementById("ui");
const gameOverEl = document.getElementById("gameOver");
const restartBtn = document.querySelector("button");

let obstacles=[], powerups=[];
let gameRunning=true;

// Kamera + score
let cameraX = 0;
let score = 0;
let hiScore = localStorage.getItem("FH_hi") || 0;

// Physics
let yVel=0;
const gravity=2;
let jumpCount=0;
const maxJumps=2;

// Dash
let dashFrames=0;
let dashCooldown=0;

// Powers (sek)
let shield=0, jumpBoost=0, magnet=0;
let teleport=0;

// START
function startGame(){
  obstacles.forEach(o=>o.el.remove());
  powerups.forEach(p=>p.el.remove());
  obstacles=[];
  powerups=[];
  score=0;
  yVel=0;
  jumpCount=0;
  dashFrames=0;
  dashCooldown=0;
  shield=jumpBoost=magnet=0;
  teleport=0;
  cameraX=0;
  player.style.left="60px";
  player.style.bottom="0px";
  gameOverEl.style.display="none";
  gameRunning=true;
}
startGame();

// LOOP
function loop(){
  requestAnimationFrame(loop);
  if(!gameRunning) return;

  // Gravity
  yVel+=gravity;
  let bottom=parseInt(player.style.bottom)-yVel;
  if(bottom<=0){bottom=0;yVel=0;jumpCount=0}
  if(bottom>=gameBox.offsetHeight-40){
    bottom=gameBox.offsetHeight-40;yVel=0
  }
  player.style.bottom=bottom+"px";

  // Dash
  if(dashFrames>0){
    player.style.left=parseInt(player.style.left)+12+"px";
    dashFrames--;
  }
  if(dashCooldown>0) dashCooldown-=1/60;

  // Kamera følger spiller
  cameraX = parseInt(player.style.left) - 60;

  // Obstacles
  obstacles.forEach((o,i)=>{
    o.el.style.left=(o.x-cameraX)+"px";

    if(collide(player,o.el) && shield<=0){
      endGame();
    }

    if(o.x-cameraX+o.w<0){
      o.el.remove();
      obstacles.splice(i,1);
      score++;
    }
  });

  // Powerups
  powerups.forEach((p,i)=>{
    p.el.style.left=(p.x-cameraX)+"px";
    if(collide(player,p.el)){
      activatePower();
      p.el.remove();
      powerups.splice(i,1);
    }
  });

  // Timers
  if(shield>0) shield-=1/60;
  if(jumpBoost>0) jumpBoost-=1/60;
  if(magnet>0) magnet-=1/60;

  // Hi-score
  if(score>hiScore){
    hiScore=score;
    localStorage.setItem("FH_hi",hiScore);
  }

  ui.innerHTML=`
Poeng: ${score} | Hi-score: ${hiScore}<br>
Shield: ${shield|0}s |
JumpBoost: ${jumpBoost|0}s |
Magnet: ${magnet|0}s<br>
Dash: ${dashCooldown<=0?"klar":(dashCooldown|0)+"s"} |
Teleport: ${teleport}
`;
}
loop();

// INPUT
document.addEventListener("keydown",e=>{
  if(e.code==="Space" && jumpCount<maxJumps){
    yVel = jumpBoost>0 ? -32 : -25;
    jumpCount++;
  }
  if(e.code==="KeyX" && dashCooldown<=0){
    dashFrames=10;
    dashCooldown=2;
  }
  if(e.code==="KeyC" && magnet>0){
    player.style.bottom =
      parseInt(player.style.bottom)>0?"0px":(gameBox.offsetHeight-40)+"px";
    yVel=0;
  }
  if(e.code==="KeyV" && teleport>0){
    player.style.bottom=Math.random()*150+"px";
    teleport--;
  }
});

// SPAWN OBSTACLES
setInterval(()=>{
  if(!gameRunning) return;
  const el=document.createElement("div");
  el.className="obstacle";
  const w=60+Math.random()*60;
  const h=60+Math.random()*100;
  el.style.width=w+"px";
  el.style.height=h+"px";
  el.style.bottom=Math.random()<0.25?"120px":"0px";
  const x=cameraX+gameBox.offsetWidth+100;
  el.style.left=(x-cameraX)+"px";
  gameBox.appendChild(el);
  obstacles.push({el,x,w});
},1500);

// SPAWN POWERUPS
setInterval(()=>{
  if(!gameRunning) return;
  const el=document.createElement("div");
  el.className="powerup";
  const x=cameraX+gameBox.offsetWidth+200;
  el.style.left=(x-cameraX)+"px";
  el.style.bottom="0px";
  gameBox.appendChild(el);
  powerups.push({el,x});
},7000);

// POWER
function activatePower(){
  const t=Math.floor(Math.random()*5);
  if(t===0) shield=15;
  if(t===1) jumpBoost=30;
  if(t===2) magnet=30;
  if(t===3) teleport++;
}

// COLLISION
function collide(a,b){
  const r1=a.getBoundingClientRect();
  const r2=b.getBoundingClientRect();
  return r1.right>r2.left && r1.left<r2.right &&
         r1.bottom>r2.top && r1.top<r2.bottom;
}

// GAME OVER
function endGame(){
  gameRunning=false;
  gameOverEl.style.display="block";
}

// RESTART
restartBtn.addEventListener("click",()=>{
  if(!gameRunning) startGame();
});
</script>

</body>
</html>
