<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>FirkanthinderlÃ¸p</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  background:#0f0f0f;
  color:white;
  font-family:Arial;
  margin:0;
  padding:20px;
}
#gameBox{
  width:560px;
  height:260px;
  background:#222;
  margin:20px auto;
  border:2px solid white;
  position:relative;
  overflow:hidden;
}
#player{
  width:40px;
  height:40px;
  background:#00ffff;
  position:absolute;
  left:60px;
  bottom:0;
}
.obstacle{position:absolute;background:red}
.powerup{
  position:absolute;
  width:24px;
  height:24px;
  background:yellow;
}
#ui{text-align:center;font-size:14px}
#gameOver{
  text-align:center;
  font-size:26px;
  color:red;
  display:none;
}
#controls{
  position:absolute;
  left:10px;
  top:10px;
  font-size:13px;
  line-height:1.4;
  opacity:0.85;
}
button{
  padding:8px 14px;
  font-size:16px;
  display:block;
  margin:10px auto;
}
</style>
</head>

<body>

<h2 style="text-align:center">FirkanthinderlÃ¸p</h2>

<div id="controls">
<b>KONTROLLER</b><br>
Space â€“ Hopp / Dobbelhopp<br>
X â€“ Dash<br>
C â€“ Magnet<br>
V â€“ Teleport
</div>

<div id="ui"></div>

<div id="gameBox">
  <div id="player"></div>
</div>

<div id="gameOver">GAME OVER</div>
<button>Spill igjen</button>

<script>
const player = document.getElementById("player");
const gameBox = document.getElementById("gameBox");
const ui = document.getElementById("ui");
const gameOverEl = document.getElementById("gameOver");
const restartBtn = document.querySelector("button");

let obstacles=[], powerups=[];
let gameRunning=true;

// SCORE
let score=0;
let hiScore = localStorage.getItem("FH_hi") || 0;

// PHYSICS
let yVel=0;
const gravity=2;
let jumpCount=0;
const maxJumps=2;

// DASH
let dashFrames=0;
let dashCooldown=0;
let dashResetCooldown=0; // ðŸ”§ BUGFIX

// POWERS
let shield=0, jumpBoost=0, magnet=0;
let teleport=0;

// START
function startGame(){
  obstacles.forEach(o=>o.remove());
  powerups.forEach(p=>p.remove());
  obstacles=[];
  powerups=[];
  score=0;
  yVel=0;
  jumpCount=0;
  dashFrames=0;
  dashCooldown=0;
  dashResetCooldown=0;
  shield=jumpBoost=magnet=0;
  teleport=0;
  player.style.left="60px";
  player.style.bottom="0px";
  gameOverEl.style.display="none";
  gameRunning=true;
}
startGame();

// LOOP
function loop(){
  requestAnimationFrame(loop);
  if(!gameRunning) return;

  // GRAVITY
  yVel+=gravity;
  let bottom=parseInt(player.style.bottom)-yVel;
  if(bottom<=0){bottom=0;yVel=0;jumpCount=0}
  player.style.bottom=bottom+"px";

  // DASH MOVE
  if(dashFrames>0){
    player.style.left=parseInt(player.style.left)+12+"px";
    dashFrames--;
  }

  // DASH RESET (BUGFIX)
  if(dashResetCooldown>0){
    dashResetCooldown-=1/60;
    if(dashResetCooldown<=0){
      player.style.left="60px";
    }
  }

  if(dashCooldown>0) dashCooldown-=1/60;

  // OBSTACLES
  obstacles.forEach((o,i)=>{
    o.style.left=parseInt(o.style.left)-5+"px";

    if(collide(player,o) && shield<=0){
      endGame();
    }

    if(parseInt(o.style.left)+o.offsetWidth<0){
      o.remove();
      obstacles.splice(i,1);
      score++;
    }
  });

  // POWERUPS
  powerups.forEach((p,i)=>{
    p.style.left=parseInt(p.style.left)-4+"px";
    if(collide(player,p)){
      activatePower();
      p.remove();
      powerups.splice(i,1);
    }
  });

  // TIMERS
  if(shield>0) shield-=1/60;
  if(jumpBoost>0) jumpBoost-=1/60;
  if(magnet>0) magnet-=1/60;

  // HISCORE
  if(score>hiScore){
    hiScore=score;
    localStorage.setItem("FH_hi",hiScore);
  }

  ui.innerHTML=`
Poeng: ${score} | Hi-score: ${hiScore}<br>
Shield: ${shield|0}s |
JumpBoost: ${jumpBoost|0}s |
Magnet: ${magnet|0}s<br>
Dash: ${dashCooldown<=0?"klar":(dashCooldown|0)+"s"} |
Teleport: ${teleport}
`;
}
loop();

// INPUT
document.addEventListener("keydown",e=>{
  if(e.code==="Space" && jumpCount<maxJumps){
    yVel = jumpBoost>0 ? -32 : -25;
    jumpCount++;
  }
  if(e.code==="KeyX" && dashCooldown<=0){
    dashFrames=10;
    dashCooldown=2;
    dashResetCooldown=1; // ðŸ”§ 1 sek fÃ¸r reset
  }
  if(e.code==="KeyC" && magnet>0){
    player.style.bottom =
      parseInt(player.style.bottom)>0?"0px":"220px";
    yVel=0;
  }
  if(e.code==="KeyV" && teleport>0){
    player.style.bottom=Math.random()*150+"px";
    teleport--;
  }
});

// SPAWN OBSTACLES
setInterval(()=>{
  if(!gameRunning) return;
  const o=document.createElement("div");
  o.className="obstacle";
  o.style.width=60+Math.random()*60+"px";
  o.style.height=60+Math.random()*100+"px";
  o.style.bottom=Math.random()<0.25?"120px":"0px";
  o.style.left=gameBox.offsetWidth+"px";
  gameBox.appendChild(o);
  obstacles.push(o);
},1500);

// SPAWN POWERUPS
setInterval(()=>{
  if(!gameRunning) return;
  const p=document.createElement("div");
  p.className="powerup";
  p.style.left=gameBox.offsetWidth+"px";
  p.style.bottom="0px";
  gameBox.appendChild(p);
  powerups.push(p);
},7000);

// POWERS
function activatePower(){
  const t=Math.floor(Math.random()*5);
  if(t===0) shield=15;
  if(t===1) jumpBoost=30;
  if(t===2) magnet=30;
  if(t===3) teleport++;
}

// COLLISION
function collide(a,b){
  const r1=a.getBoundingClientRect();
  const r2=b.getBoundingClientRect();
  return r1.right>r2.left && r1.left<r2.right &&
         r1.bottom>r2.top && r1.top<r2.bottom;
}

// GAME OVER
function endGame(){
  gameRunning=false;
  gameOverEl.style.display="block";
}

// RESTART
restartBtn.addEventListener("click",()=>{
  if(!gameRunning) startGame();
});
</script>

</body>
</html>
