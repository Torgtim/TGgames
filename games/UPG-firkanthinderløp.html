
<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Firkanthinderløp – UPGRADED</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  background:#0f0f0f;
  color:white;
  font-family:Arial;
  margin:0;
  padding:20px;
}
#gameBox{
  width:560px;
  height:260px;
  background:#222;
  margin:20px auto;
  border:2px solid white;
  position:relative;
  overflow:hidden;
}
#player{
  width:40px;
  height:40px;
  background:#00ffff;
  position:absolute;
  left:60px;
  bottom:0;
}
.obstacle{position:absolute;background:red}
.powerup{position:absolute;width:24px;height:24px;background:yellow}
#ui{font-size:14px;text-align:center}
#gameOver{font-size:26px;color:red;display:none;text-align:center}
#controls{
  position:absolute;
  left:10px;
  top:10px;
  font-size:13px;
  text-align:left;
  line-height:1.4;
  opacity:0.85;
}
button{
  padding:8px 14px;
  font-size:16px;
  display:block;
  margin:10px auto;
}
</style>
</head>

<body>
<h1 style="text-align:center">Firkanthinderløp – UPGRADED</h1>

<div id="controls">
<b>KONTROLLER</b><br>
⎵ Space – Hopp / Dobbelhopp<br>
X – Dash<br>
C – Magnet flip<br>
V – Teleport
</div>

<div id="ui"></div>

<div id="gameBox">
  <div id="player"></div>
</div>

<div id="gameOver">GAME OVER</div>
<button>Spill igjen</button>

<script>
const player = document.getElementById("player");
const gameBox = document.getElementById("gameBox");
const ui = document.getElementById("ui");
const gameOverEl = document.getElementById("gameOver");
const restartBtn = document.querySelector("button");

let obstacles=[], powerups=[];
let score=0;
let gameRunning=true;
let hiScore = 0;

// Physics
let yVel=0;
const gravity=2;
let jumpCount=0;
const maxJumps=2;

// Powers (seconds)
let shield=0, jumpBoost=0, magnet=0;
let teleport=0;

// Dash
let dashCooldown=0;
let dashFrames=0;

// START GAME
function startGame(){
  obstacles.forEach(o=>o.remove());
  powerups.forEach(p=>p.remove());
  obstacles=[]; powerups=[];
  score=0;
  yVel=0;
  jumpCount=0;
  shield=jumpBoost=magnet=0;
  teleport=0;
  dashCooldown=0;
  dashFrames=0;
  player.style.left="60px";
  player.style.bottom="0px";
  gameOverEl.style.display="none";
  gameRunning=true;
}

// START AUTOMATISK
startGame();

// LOOP
function loop(){
  requestAnimationFrame(loop);
  if(!gameRunning) return;

  // Gravity
  yVel+=gravity;
  let bottom=parseInt(player.style.bottom)-yVel;
  if(bottom<=0){bottom=0;yVel=0;jumpCount=0}
  if(bottom>=gameBox.offsetHeight-40){bottom=gameBox.offsetHeight-40;yVel=0}
  player.style.bottom=bottom+"px";

  // Dash
  if(dashFrames>0){
    player.style.left =
      Math.min(parseInt(player.style.left)+12, gameBox.offsetWidth-40)+"px";
    dashFrames--;
  }

  // Timers
  if(shield>0) shield-=1/60;
  if(jumpBoost>0) jumpBoost-=1/60;
  if(magnet>0) magnet-=1/60;
  if(dashCooldown>0) dashCooldown-=1/60;

  // Obstacles
  obstacles.forEach((o,i)=>{
    o.x-=o.speed;
    o.style.left=o.x+"px";

    if(collide(player,o) && shield<=0){
      endGame();
    }

    if(o.x+o.offsetWidth<0){
      o.remove();
      obstacles.splice(i,1);
      score++;
    }
  });

  // Powerups
  powerups.forEach((p,i)=>{
    p.x-=4;
    p.style.left=p.x+"px";
    if(collide(player,p)){
      activatePower();
      p.remove();
      powerups.splice(i,1);
    }
  });

  // UI med Hi-score
  ui.innerHTML=`
Poeng: ${score} | Hi-score: ${hiScore}<br>
Shield: ${Math.max(0,shield|0)}s |
JumpBoost: ${Math.max(0,jumpBoost|0)}s |
Magnet: ${Math.max(0,magnet|0)}s<br>
Dash: ${dashCooldown<=0?"klar":(dashCooldown|0)+"s"} |
Teleport: ${teleport}
  `;
}
loop();

// Kollisjon
function collide(a,b){
  const r1=a.getBoundingClientRect();
  const r2=b.getBoundingClientRect();
  return r1.right>r2.left && r1.left<r2.right && r1.bottom>r2.top && r1.top<r2.bottom;
}

// Tastetrykk
document.addEventListener("keydown",e=>{
  if(e.code==="Space" && jumpCount<maxJumps){
    yVel = jumpBoost>0 ? -32 : -25;
    jumpCount++;
  }
  if(e.code==="KeyX" && dashCooldown<=0){
    dashFrames=10;
    dashCooldown=2;
  }
  if(e.code==="KeyC" && magnet>0){
    player.style.bottom =
      parseInt(player.style.bottom)>0 ? "0px" : (gameBox.offsetHeight-40)+"px";
    yVel=0;
  }
  if(e.code==="KeyV" && teleport>0){
    player.style.bottom=Math.random()*150+"px";
    teleport--;
  }
});

// Obstacles
setInterval(()=>{
  if(!gameRunning || obstacles.length>4) return;
  const o=document.createElement("div");
  o.className="obstacle";
  o.style.width=60+Math.random()*60+"px";
  o.style.height=60+Math.random()*100+"px";
  o.style.bottom=Math.random()<0.25?"120px":"0px";
  o.x=gameBox.offsetWidth;
  o.speed=5+Math.random()*2;
  o.style.left=o.x+"px";
  gameBox.appendChild(o);
  obstacles.push(o);
},1500);

// Powerups
setInterval(()=>{
  if(!gameRunning) return;
  if(obstacles.some(o=>o.x>gameBox.offsetWidth-120)) return;

  const p=document.createElement("div");
  p.className="powerup";
  p.x=gameBox.offsetWidth;
  p.style.left=p.x+"px";
  p.style.bottom="0px";
  gameBox.appendChild(p);
  powerups.push(p);
},7000);

// Aktiver powerup
function activatePower(){
  const t=Math.floor(Math.random()*5);
  if(t===0) shield=15;
  if(t===1) jumpBoost=30;
  if(t===2) magnet=30;
  if(t===3) teleport++;
}

// Game Over
function endGame(){
  gameRunning=false;
  gameOverEl.style.display="block";
  if(score>hiScore) hiScore=score;
}

// Spill igjen - kun hvis dødd
restartBtn.addEventListener("click", () => {
  if(!gameRunning){
    startGame();
  }
});
</script>

</body>
</html>
